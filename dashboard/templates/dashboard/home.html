{% extends 'dashboard/base.html' %}

{% block title %}Dashboard - Jitsi{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="stats">
    <div class="stat-card">
        <div class="label">Active Conferences</div>
        <div class="value">{{ server_overview.summary.active_conferences|default:"--" }}</div>
    </div>
    <div class="stat-card">
        <div class="label">Active Participants</div>
        <div class="value">{{ server_overview.summary.active_participants|default:"--" }}</div>
    </div>
    <div class="stat-card">
        <div class="label">Upload</div>
        <div class="value">{{ server_overview.summary.upload_bitrate_kbps|floatformat:0|default:"--" }} kbps</div>
    </div>
    <div class="stat-card">
        <div class="label">Download</div>
        <div class="value">{{ server_overview.summary.download_bitrate_kbps|floatformat:0|default:"--" }} kbps</div>
    </div>
</div>

<div class="card">
    <div class="card-header">Server Status</div>
    <div class="card-body">
        <p>
            <strong>JVB:</strong> 
            {% if server_overview.components.jvb.healthy %}<span class="badge badge-success">Healthy</span>{% else %}<span class="badge badge-danger">Offline</span>{% endif %}
            &nbsp;&nbsp;
            <strong>Jicofo:</strong> 
            {% if server_overview.components.jicofo.healthy %}<span class="badge badge-success">Healthy</span>{% else %}<span class="badge badge-danger">Offline</span>{% endif %}
            &nbsp;&nbsp;
            <strong>Jibri:</strong> 
            {% if server_overview.components.jibri.available %}<span class="badge badge-success">Available</span>{% else %}<span class="badge badge-warning">N/A</span>{% endif %}
        </p>
    </div>
</div>

<div class="grid-2">
    <div class="card">
        <div class="card-header">Quick Actions</div>
        <div class="card-body">
            <a href="{% url 'dashboard:create_meeting' %}" class="btn btn-primary" style="display:block; margin-bottom:10px; text-align:center;"><i class="fas fa-plus"></i> Create Meeting</a>
            <a href="{% url 'dashboard:conferences' %}" class="btn btn-secondary" style="display:block; text-align:center;"><i class="fas fa-list"></i> View Conferences</a>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">Recent Conferences</div>
        <table>
            <thead>
                <tr><th>Room</th><th>Status</th><th>Participants</th><th>Duration</th></tr>
            </thead>
            <tbody>
                {% for conf in recent_conferences %}
                <tr>
                    <td><a href="{% url 'dashboard:conference_detail' conf.pk %}">{{ conf.display_name|default:conf.room_name }}</a></td>
                    <td>
                        {% if conf.status == 'active' %}<span class="badge badge-success">Active</span>
                        {% elif conf.status == 'ended' %}<span class="badge badge-info">Ended</span>
                        {% else %}<span class="badge badge-warning">{{ conf.status }}</span>{% endif %}
                    </td>
                    <td>{{ conf.max_participants }}</td>
                    <td>{{ conf.duration }} min</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="text-align:center; color:#999; padding:30px;">No conferences yet</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
